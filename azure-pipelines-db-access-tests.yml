variables:
    buildConfiguration: "Release"
    solution: "KernelManagementLab.sln"

jobs:

  - job: DB_Access_Tests
    pool:
      vmImage: 'ubuntu-20.04'
    
    steps:
      - bash: |
          set -eu; set -o pipefail
          script=https://raw.githubusercontent.com/devizer/test-and-build/master/install-build-tools-bundle.sh; (wget -q -nv --no-check-certificate -O - $script 2>/dev/null || curl -ksSL $script) | bash >/dev/null
          Say --Reset-Stopwatch

          Say "APT update"
          try-and-retry sudo apt-get update -qq
          try-and-retry sudo apt-get install postgresql-client mysql-client -y -qq

          Say "Install DotNet"
          script=https://raw.githubusercontent.com/devizer/test-and-build/master/lab/install-DOTNET.sh; (wget -q -nv --no-check-certificate -O - $script 2>/dev/null || curl -ksSL $script) | bash; test -s /usr/share/dotnet/dotnet && sudo ln -f -s /usr/share/dotnet/dotnet /usr/local/bin/dotnet
          dotnet --list-sdks

          export HIDE_PULL_PROGRESS=True
          cd Universe.Dashboard.DAL.Tests
          Say "Launch DB Servers"
          time bash -e ./prepare-db-servers.sh

          Say "TESTS"
          time bash -e local-tests.sh
          Say "Done"
        displayName: 'Test'

trigger:
  - master

pr:
  branches:
    exclude:
      - '*'


